{"ast":null,"code":"import _toConsumableArray from\"/Users/tazh/Desktop/Study/Record-Store/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/tazh/Desktop/Study/Record-Store/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{Link}from'react-router-dom';import{useQuery}from'@apollo/client';import{QUERY_USER}from'../utils/queries';import{useMutation}from'@apollo/client';import{REMOVE_THOUGHT}from'../utils/mutations';import{QUERY_THOUGHTS}from'../utils/queries';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function OrderHistory(){console.log('req');var _useQuery=useQuery(QUERY_USER),data=_useQuery.data,loading=_useQuery.loading;console.log({data:data});var _useState=useState({user:{},orders:[],thoughts:[]}),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];useEffect(function(){console.log('eff');console.log({loading:loading,data:data});if(data){console.log({data:data});setUser(data.user);// user = data.user;\n// console.log(user);\n}},[data,loading]);var _useMutation=useMutation(REMOVE_THOUGHT,{update:function update(cache,_ref){var addThought=_ref.data.addThought;try{var _cache$readQuery=cache.readQuery({query:QUERY_THOUGHTS}),thoughts=_cache$readQuery.thoughts;cache.writeQuery({query:QUERY_THOUGHTS,data:{thoughts:[removeThought].concat(_toConsumableArray(thoughts))}});}catch(e){console.error(e);}// update me object's cache\n// const { me } = cache.readQuery({ query: QUERY_ME });\n// cache.writeQuery({\n//   query: QUERY_ME,\n//   data: { me: { ...me, thoughts: [...me.thoughts, addThought] } },\n// });\n}}),_useMutation2=_slicedToArray(_useMutation,2),removeThought=_useMutation2[0],error=_useMutation2[1].error;return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container px-2\",children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"\\u2190 Back to Products\"}),loading?'Loading...':data&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Order History for \",user.firstName,\" \",user.lastName]}),user.orders.map(function(order){return/*#__PURE__*/_jsxs(\"div\",{className:\"my-2\",children:[/*#__PURE__*/_jsx(\"h3\",{children:new Date(parseInt(order.purchaseDate)).toLocaleDateString()}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-row\",children:order.products.length&&order.products.map(function(_ref2,index){var _id=_ref2._id,image=_ref2.image,name=_ref2.name,price=_ref2.price;return/*#__PURE__*/_jsxs(\"div\",{className:\"card px-1 py-1\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/products/\".concat(_id),children:[/*#__PURE__*/_jsx(\"img\",{alt:name,src:\"/images/\".concat(image)}),/*#__PURE__*/_jsx(\"p\",{children:name})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"span\",{children:[\"$\",price]})})]},index);})})]},order._id);}),/*#__PURE__*/_jsxs(\"h2\",{children:[\"Post History for \",user.firstName]}),user.thoughts.map(function(thought){return/*#__PURE__*/_jsxs(\"div\",{className:\"postTexr\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"card-header bg-primary text-light p-2 m-0\",children:/*#__PURE__*/_jsxs(Link,{className:\"text-light\",to:\"/thoughts/\".concat(thought._id),children:[thought.thoughtAuthor,\" \",/*#__PURE__*/_jsx(\"br\",{})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body bg-light p-2\",children:[/*#__PURE__*/_jsx(\"p\",{children:thought.thoughtText}),/*#__PURE__*/_jsx(\"a\",{href:\"/\",children:\"Remove\"})]}),/*#__PURE__*/_jsx(Link,{className:\"btn btn-primary btn-block btn-squared\",to:\"/thoughts/\".concat(thought._id),children:\"Join the discussion.\"})]},thought._id);})]})]})});}export default OrderHistory;","map":{"version":3,"names":["React","useEffect","useState","Link","useQuery","QUERY_USER","useMutation","REMOVE_THOUGHT","QUERY_THOUGHTS","OrderHistory","console","log","data","loading","user","orders","thoughts","setUser","update","cache","addThought","readQuery","query","writeQuery","removeThought","e","error","firstName","lastName","map","order","Date","parseInt","purchaseDate","toLocaleDateString","products","length","index","_id","image","name","price","thought","thoughtAuthor","thoughtText"],"sources":["/Users/tazh/Desktop/Study/Record-Store/client/src/pages/OrderHistory.js"],"sourcesContent":["import React, {useEffect, useState} from 'react';\nimport { Link } from 'react-router-dom';\n\nimport { useQuery } from '@apollo/client';\nimport { QUERY_USER } from '../utils/queries';\nimport { useMutation } from '@apollo/client';\nimport { REMOVE_THOUGHT } from '../utils/mutations';\nimport { QUERY_THOUGHTS } from '../utils/queries';\n\nfunction OrderHistory() {\n  console.log('req');\n  const { data, loading  } = useQuery(QUERY_USER);\n\n  console.log({data})\n  const [user, setUser] = useState({user:{}, orders:[], thoughts:[]});\n\n  useEffect(() => {\n    console.log('eff')\n    console.log({loading, data})\n    if (data) {\n    console.log({data});\n      setUser(data.user);\n      // user = data.user;\n      // console.log(user);\n    }\n  }, [data, loading]);\n\n  const [removeThought, { error }] = useMutation(REMOVE_THOUGHT, {\n    update(cache, { data: { addThought } }) {\n      try {\n        const { thoughts } = cache.readQuery({ query: QUERY_THOUGHTS });\n\n        cache.writeQuery({\n          query: QUERY_THOUGHTS,\n          data: { thoughts: [removeThought, ...thoughts] },\n        });\n      } catch (e) {\n        console.error(e);\n      }\n\n      // update me object's cache\n      // const { me } = cache.readQuery({ query: QUERY_ME });\n      // cache.writeQuery({\n      //   query: QUERY_ME,\n      //   data: { me: { ...me, thoughts: [...me.thoughts, addThought] } },\n      // });\n    },\n  });\n\n  return (\n    <>\n      <div className=\"container px-2\">\n        <Link to=\"/\">‚Üê Back to Products</Link>\n\n        {loading ? 'Loading...' : (data &&\n          <>\n            <h2>\n              Order History for {user.firstName} {user.lastName}\n            </h2>\n            {user.orders.map((order) => (\n              <div key={order._id} className=\"my-2\">\n                <h3>\n                  {new Date(parseInt(order.purchaseDate)).toLocaleDateString()}\n                </h3>\n                <div className=\"flex-row\">\n                  {order.products.length && order.products.map(({ _id, image, name, price }, index) => (\n                    <div key={index} className=\"card px-1 py-1\">\n                      <Link to={`/products/${_id}`}>\n                        <img alt={name} src={`/images/${image}`} />\n                        <p>{name}</p>\n                      </Link>\n                      <div>\n                        <span>${price}</span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ))}\n            <h2>\n              Post History for {user.firstName}\n            </h2>\n            {user.thoughts.map((thought) => (\n              <div key={thought._id} className=\"postTexr\">\n              <h4 className=\"card-header bg-primary text-light p-2 m-0\">\n                  <Link\n                    className=\"text-light\"\n                    to={`/thoughts/${thought._id}`}\n                  >\n                    {thought.thoughtAuthor} <br />\n                  </Link>\n              </h4>\n              <div className=\"card-body bg-light p-2\">\n                <p>{thought.thoughtText}</p>\n                <a href=\"/\" >Remove</a>\n              </div>\n              \n              \n              <Link\n                className=\"btn btn-primary btn-block btn-squared\"\n                to={`/thoughts/${thought._id}`}\n              >\n                Join the discussion.\n              </Link>\n            </div>\n            ))}\n          </>\n        )}\n      </div>\n    </>\n  );\n}\n\nexport default OrderHistory;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}