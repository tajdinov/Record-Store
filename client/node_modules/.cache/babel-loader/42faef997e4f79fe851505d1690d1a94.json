{"ast":null,"code":"import _regeneratorRuntime from\"/Users/tazh/Desktop/Study/Record-Store/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/tazh/Desktop/Study/Record-Store/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/tazh/Desktop/Study/Record-Store/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/tazh/Desktop/Study/Record-Store/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from'react';import{Link}from'react-router-dom';import{useMutation}from'@apollo/client';import{ADD_THOUGHT}from'../../utils/mutations';import{QUERY_THOUGHTS}from'../../utils/queries';import Auth from'../../utils/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ThoughtForm=function ThoughtForm(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),thoughtText=_useState2[0],setThoughtText=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),characterCount=_useState4[0],setCharacterCount=_useState4[1];var _useMutation=useMutation(ADD_THOUGHT,{update:function update(cache,_ref){var addThought=_ref.data.addThought;try{var _cache$readQuery=cache.readQuery({query:QUERY_THOUGHTS}),thoughts=_cache$readQuery.thoughts;cache.writeQuery({query:QUERY_THOUGHTS,data:{thoughts:[addThought].concat(_toConsumableArray(thoughts))}});}catch(e){console.error(e);}// update me object's cache\n// const { me } = cache.readQuery({ query: QUERY_ME });\n// cache.writeQuery({\n//   query: QUERY_ME,\n//   data: { me: { ...me, thoughts: [...me.thoughts, addThought] } },\n// });\n}}),_useMutation2=_slicedToArray(_useMutation,2),addThought=_useMutation2[0],error=_useMutation2[1].error;var handleFormSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var _yield$addThought,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_context.prev=1;_context.next=4;return addThought({variables:{thoughtText:thoughtText,thoughtAuthor:Auth.getProfile().data.firstName}});case 4:_yield$addThought=_context.sent;data=_yield$addThought.data;setThoughtText('');_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function handleFormSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;if(name==='thoughtText'&&value.length<=280){setThoughtText(value);setCharacterCount(value.length);}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"What's on your mind?\"}),Auth.loggedIn()?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"m-0 \".concat(characterCount===280||error?'text-danger':''),children:[\"Character Count: \",characterCount,\"/280\"]}),/*#__PURE__*/_jsxs(\"form\",{className:\"flex-row justify-center justify-space-between-md align-center\",onSubmit:handleFormSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-12 col-lg-9\",children:/*#__PURE__*/_jsx(\"textarea\",{name:\"thoughtText\",placeholder:\"...\",value:thoughtText,className:\"form-input w-100\",style:{lineHeight:'1.5',resize:'vertical'},onChange:handleChange})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-12 col-lg-3\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary btn-block py-3\",type:\"submit\",children:\"Add Thought\"})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"col-12 my-3 bg-danger text-white p-3\",children:error.message})]})]}):/*#__PURE__*/_jsxs(\"p\",{children:[\"You need to be logged in to share your thoughts. Please\",' ',/*#__PURE__*/_jsx(Link,{to:\"/login\",children:\"login\"}),\" or \",/*#__PURE__*/_jsx(Link,{to:\"/signup\",children:\"signup.\"})]})]});};export default ThoughtForm;","map":{"version":3,"names":["React","useState","Link","useMutation","ADD_THOUGHT","QUERY_THOUGHTS","Auth","ThoughtForm","thoughtText","setThoughtText","characterCount","setCharacterCount","update","cache","addThought","data","readQuery","query","thoughts","writeQuery","e","console","error","handleFormSubmit","event","preventDefault","variables","thoughtAuthor","getProfile","firstName","handleChange","target","name","value","length","loggedIn","lineHeight","resize","message"],"sources":["/Users/tazh/Desktop/Study/Record-Store/client/src/components/ThoughtForm/index.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { useMutation } from '@apollo/client';\n\nimport { ADD_THOUGHT } from '../../utils/mutations';\nimport { QUERY_THOUGHTS } from '../../utils/queries';\n\nimport Auth from '../../utils/auth';\n\nconst ThoughtForm = () => {\n  const [thoughtText, setThoughtText] = useState('');\n\n  const [characterCount, setCharacterCount] = useState(0);\n\n  const [addThought, { error }] = useMutation(ADD_THOUGHT, {\n    update(cache, { data: { addThought } }) {\n      try {\n        const { thoughts } = cache.readQuery({ query: QUERY_THOUGHTS });\n\n        cache.writeQuery({\n          query: QUERY_THOUGHTS,\n          data: { thoughts: [addThought, ...thoughts] },\n        });\n      } catch (e) {\n        console.error(e);\n      }\n\n      // update me object's cache\n      // const { me } = cache.readQuery({ query: QUERY_ME });\n      // cache.writeQuery({\n      //   query: QUERY_ME,\n      //   data: { me: { ...me, thoughts: [...me.thoughts, addThought] } },\n      // });\n    },\n  });\n\n  const handleFormSubmit = async (event) => {\n    event.preventDefault();\n\n    try {\n      const { data } = await addThought({\n        variables: {\n          thoughtText,\n          thoughtAuthor: Auth.getProfile().data.firstName,\n        },\n      });\n\n      setThoughtText('');\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const handleChange = (event) => {\n    const { name, value } = event.target;\n\n    if (name === 'thoughtText' && value.length <= 280) {\n      setThoughtText(value);\n      setCharacterCount(value.length);\n    }\n  };\n\n  return (\n    <div>\n      <h3>What's on your mind?</h3>\n\n      {Auth.loggedIn() ? (\n        <>\n          <p\n            className={`m-0 ${\n              characterCount === 280 || error ? 'text-danger' : ''\n            }`}\n          >\n            Character Count: {characterCount}/280\n          </p>\n          <form\n            className=\"flex-row justify-center justify-space-between-md align-center\"\n            onSubmit={handleFormSubmit}\n          >\n            <div className=\"col-12 col-lg-9\">\n              <textarea\n                name=\"thoughtText\"\n                placeholder=\"...\"\n                value={thoughtText}\n                className=\"form-input w-100\"\n                style={{ lineHeight: '1.5', resize: 'vertical' }}\n                onChange={handleChange}\n              ></textarea>\n            </div>\n\n            <div className=\"col-12 col-lg-3\">\n              <button className=\"btn btn-primary btn-block py-3\" type=\"submit\">\n                Add Thought\n              </button>\n            </div>\n            {error && (\n              <div className=\"col-12 my-3 bg-danger text-white p-3\">\n                {error.message}\n              </div>\n            )}\n          </form>\n        </>\n      ) : (\n        <p>\n          You need to be logged in to share your thoughts. Please{' '}\n          <Link to=\"/login\">login</Link> or <Link to=\"/signup\">signup.</Link>\n        </p>\n      )}\n    </div>\n  );\n};\n\nexport default ThoughtForm;"],"mappings":"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"},"metadata":{},"sourceType":"module"}